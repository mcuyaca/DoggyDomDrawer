---
import InputText from "./elements/InputText.astro";
import svgBuilding from "./icons/Building.astro";
---

<section class="flex w-full flex-col items-center justify-center gap-8">
  <h3 class="text-3xl font-bold">Comienaza a dibujar</h3>

  <div class="flex gap-[90px]">
    <div class="grid w-full gap-8">
      <div class="flex w-full flex-col gap-3">
        <InputText
          label="Titulo:"
          placeholder="Ingresar el nuevo texto"
          id="textoInput"
        />

        <InputText
          label="Ciudad:"
          placeholder="Ingresar el nuevo texto"
          id="textoInput3"
        />

        <button
          class="mt-3 border-2 border-black bg-slate-300 px-4 py-2 font-bold shadow-[4px_4px_0px_rgba(0,0,0,1)] focus:bg-rose-300 focus:outline-none"
          id="aplicarCambiosBoton">Aplicar Cambios</button
        >
      </div>

      <div class="flex flex-col gap-4">
        <input
          class="border-2 border-black bg-white p-2.5 px-4 py-2 shadow-[4px_4px_0px_rgba(0,0,0,1)] file:rounded file:border-0 file:bg-slate-300 file:font-bold focus:bg-rose-300 focus:outline-none"
          type="file"
          id="subirArchivo"
          accept="image/*"
        />
        <button
          class="mt-3 border-2 border-black bg-slate-300 px-4 py-2 font-bold shadow-[4px_4px_0px_rgba(0,0,0,1)] focus:bg-rose-300 focus:outline-none"
          id="descargarBoton">Descargar Imagen</button
        >
      </div>
    </div>

    <canvas class="h-fit w-fit bg-white" id="miCanvas" width="450" height='180"'
    ></canvas>
  </div>
</section>

<style></style>

<script is:inline>
  function DibujoInicial(ctx) {
    // Dibuja el SVG
    // Tu SVG como cadena

    let svgString = `<svg
  xmlns="http://www.w3.org/2000/svg"
  class="icon icon-tabler icon-tabler-phone"
  width="24"
  height="24"
  viewBox="0 0 24 24"
  stroke-width="2"
  stroke="currentColor"
  fill="none"
  stroke-linecap="round"
  stroke-linejoin="round"
  ><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path
    d="M5 4h4l2 5l-2.5 1.5a11 11 0 0 0 5 5l1.5 -2.5l5 2v4a2 2 0 0 1 -2 2a16 16 0 0 1 -15 -15a2 2 0 0 1 2 -2"
  ></path></svg
>
`;

    const img = new Image();
    img.src = "data:image/svg+xml;base64," + btoa(svgString);

    img.onload = function () {
      ctx.drawImage(img, 190, 12, 20, 20);
      ctx.drawImage(img, 190, 37, 20, 20);
      ctx.drawImage(img, 190, 63, 20, 20);
      ctx.drawImage(img, 190, 87, 20, 20);
      ctx.drawImage(img, 190, 114, 20, 20);
    };
    // Dibuja el texto blanco
    ctx.font = "600 14px Onest Variable";
    ctx.fillStyle = "black";
    ctx.fillText("Nombre apellido", 220, 30);
    ctx.fillText("Cargo", 220, 55);
    ctx.fillText("Av. Dirección", 220, 80);
    ctx.fillText("Teléfono: +123 456 789", 220, 105);
    ctx.fillText("www.tusitio.com", 220, 130);
  }

  document.addEventListener("DOMContentLoaded", () => {
    const canvas = document.getElementById("miCanvas");
    const ctx = canvas.getContext("2d");
    const subirArchivoInput = document.getElementById("subirArchivo");
    const aplicarCambiosBoton = document.getElementById("aplicarCambiosBoton");
    const descargarBoton = document.getElementById("descargarBoton");

    DibujoInicial(ctx);

    // Manejar el cambio en la selección de archivo
    subirArchivoInput.addEventListener("change", (event) => {
      const archivo = event.target.files[0];
      if (archivo) {
        const lector = new FileReader();
        lector.onload = function (e) {
          const imagen = new Image();
          imagen.src = e.target.result;
          imagen.onload = function () {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            DibujoInicial(ctx, imagen);
          };
        };

        lector.readAsDataURL(archivo);
      }
    });

    aplicarCambiosBoton.addEventListener("click", () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      DibujoInicial(ctx);
    });

    descargarBoton.addEventListener("click", () => {
      const dataURL = canvas.toDataURL("image/jpg");
      const enlaceDescarga = document.createElement("a");
      enlaceDescarga.href = dataURL;
      enlaceDescarga.download = "mi_mapa.jpg";
      enlaceDescarga.click();
    });
  });
</script>
 ../../public/Icons.ts
